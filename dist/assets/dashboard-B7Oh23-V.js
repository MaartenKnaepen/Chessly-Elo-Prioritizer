import{r,j as s,c as I,R as U}from"./client-DYDkQYN6.js";function P(){const[o,j]=r.useState([]),[y,k]=r.useState([]),[g,w]=r.useState("all"),[f,L]=r.useState([]),[p,E]=r.useState(null),[l,T]=r.useState("none"),[i,N]=r.useState("desc"),[v,b]=r.useState(!1),[x,S]=r.useState({speeds:["blitz","rapid","classical"],ratings:[1600,1800,2e3,2200,2500]}),A=e=>e.replace(/([A-Z])/g," $1").trim().split(" ").map(t=>t.charAt(0).toUpperCase()+t.slice(1)).join(" ");r.useEffect(()=>{R(),C(),$();const e=a=>{if(a.type==="LINE_ENRICHED"){const n=a.payload;F(n.line)}};chrome.runtime.onMessage.addListener(e);const t=setInterval(C,1e3);return()=>{chrome.runtime.onMessage.removeListener(e),clearInterval(t)}},[]),r.useEffect(()=>{let e=g==="all"?[...o]:o.filter(t=>t.opening===g);l!=="none"&&e.sort((t,a)=>{var n,c;if(l==="totalGames"){const d=((n=t.stats)==null?void 0:n.total)||0,h=((c=a.stats)==null?void 0:c.total)||0;return i==="desc"?h-d:d-h}else if(l==="moves"){const d=Array.isArray(t.moves)?t.moves.join(" "):String(t.moves),h=Array.isArray(a.moves)?a.moves.join(" "):String(a.moves),u=d.localeCompare(h);return i==="desc"?-u:u}else{const d=String(t[l]||""),h=String(a[l]||""),u=d.localeCompare(h);return i==="desc"?-u:u}}),k(e)},[o,g,l,i]),r.useEffect(()=>{const e=Array.from(new Set(o.map(t=>t.opening)));L(e.sort())},[o]);const R=async()=>{const t=(await chrome.storage.local.get("extracted_lines")).extracted_lines||[];j(t)},C=async()=>{const e=await chrome.runtime.sendMessage({type:"GET_STATUS"});E(e)},$=async()=>{const e=await chrome.storage.local.get("lichess_settings");e.lichess_settings&&S(e.lichess_settings)},F=e=>{j(t=>t.some(n=>n.chapter===e.chapter&&n.study===e.study&&n.variation===e.variation)?t:[...t,e])},O=()=>{const e=JSON.stringify(o,null,2),t=new Blob([e],{type:"application/json"}),a=URL.createObjectURL(t),n=document.createElement("a");n.href=a,n.download=`chessly-export-${new Date().toISOString().split("T")[0]}.json`,n.click(),URL.revokeObjectURL(a)},M=e=>{if(!e.stats||!e.stats.total||e.stats.total===0)return{text:"No data",percentages:null};const{white:t,draws:a,black:n,total:c}=e.stats,d=(t/c*100).toFixed(1),h=(a/c*100).toFixed(1),u=(n/c*100).toFixed(1);return{text:`W: ${t} (${d}%) | D: ${a} (${h}%) | B: ${n} (${u}%)`,percentages:{white:t/c*100,draws:a/c*100,black:n/c*100}}},m=e=>{l===e?N(t=>t==="desc"?"asc":"desc"):(T(e),N(e==="totalGames"?"desc":"asc"))},D=e=>{S(t=>{const a=t.speeds.includes(e)?t.speeds.filter(n=>n!==e):[...t.speeds,e];return{...t,speeds:a}})},G=e=>{S(t=>{const a=t.ratings.includes(e)?t.ratings.filter(n=>n!==e):[...t.ratings,e];return{...t,ratings:a}})},_=async()=>{if(x.speeds.length===0){alert("Please select at least one speed");return}if(x.ratings.length===0){alert("Please select at least one rating");return}await chrome.runtime.sendMessage({type:"UPDATE_SETTINGS",payload:x}),await chrome.runtime.sendMessage({type:"REFRESH_STATS"}),j([]),b(!1)};return s.jsxs("div",{className:"dashboard",children:[s.jsxs("div",{className:"dashboard-header",children:[s.jsx("h1",{children:"♟️ Chessly Explorer Dashboard"}),s.jsxs("div",{className:"dashboard-header-actions",children:[p&&s.jsxs(s.Fragment,{children:[s.jsx("span",{className:`status-badge ${p.state}`,children:p.state}),s.jsxs("span",{style:{color:"#ecf0f1",fontSize:"14px"},children:["Lines: ",p.lineCount," | Queue: ",p.queueLength]})]}),s.jsx("button",{onClick:()=>b(!v),children:"⚙️ Settings"}),s.jsx("button",{onClick:O,disabled:o.length===0,children:"Export JSON"})]})]}),v&&s.jsxs("div",{className:"settings-panel",children:[s.jsx("h3",{children:"Lichess Statistics Filters"}),s.jsxs("div",{className:"settings-content",children:[s.jsxs("div",{className:"settings-group",children:[s.jsx("h4",{children:"Time Controls:"}),s.jsx("div",{className:"checkbox-group",children:["ultraBullet","bullet","blitz","rapid","classical","correspondence"].map(e=>s.jsxs("label",{children:[s.jsx("input",{type:"checkbox",checked:x.speeds.includes(e),onChange:()=>D(e)}),A(e)]},e))})]}),s.jsxs("div",{className:"settings-group",children:[s.jsx("h4",{children:"Rating Ranges:"}),s.jsx("div",{className:"checkbox-group",children:[400,1e3,1200,1400,1600,1800,2e3,2200,2500].map(e=>s.jsxs("label",{children:[s.jsx("input",{type:"checkbox",checked:x.ratings.includes(e),onChange:()=>G(e)}),e,"+"]},e))})]})]}),s.jsxs("div",{className:"settings-actions",children:[s.jsx("button",{onClick:_,className:"apply-button",children:"Apply & Refresh Stats"}),s.jsx("button",{onClick:()=>b(!1),className:"cancel-button",children:"Cancel"})]}),s.jsx("p",{className:"settings-note",children:"Note: Applying new settings will re-fetch all Lichess statistics. This may take some time."})]}),f.length>0&&s.jsxs("div",{className:"filter-bar",children:[s.jsx("label",{htmlFor:"course-filter",children:"Filter by Opening/Course:"}),s.jsxs("select",{id:"course-filter",value:g,onChange:e=>w(e.target.value),children:[s.jsxs("option",{value:"all",children:["All Courses (",o.length," lines)"]}),f.map(e=>{const t=o.filter(a=>a.opening===e).length;return s.jsxs("option",{value:e,children:[e," (",t," lines)"]},e)})]})]}),s.jsx("div",{className:"table-container",children:y.length===0?s.jsxs("div",{className:"empty-state",children:[s.jsx("h2",{children:"No Data Yet"}),s.jsx("p",{children:"Start an extraction from the popup to see data here."}),s.jsx("p",{style:{marginTop:"8px",fontSize:"14px"},children:"Data will appear in real-time as it's extracted and enriched."})]}):s.jsxs("table",{className:"data-table",children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsxs("th",{onClick:()=>m("opening"),className:"sortable-header",title:"Click to sort by Opening",children:["Opening ",l==="opening"&&(i==="desc"?"▼":"▲")]}),s.jsxs("th",{onClick:()=>m("chapter"),className:"sortable-header",title:"Click to sort by Chapter",children:["Chapter ",l==="chapter"&&(i==="desc"?"▼":"▲")]}),s.jsxs("th",{onClick:()=>m("study"),className:"sortable-header",title:"Click to sort by Study",children:["Study ",l==="study"&&(i==="desc"?"▼":"▲")]}),s.jsxs("th",{onClick:()=>m("variation"),className:"sortable-header",title:"Click to sort by Variation",children:["Variation ",l==="variation"&&(i==="desc"?"▼":"▲")]}),s.jsxs("th",{onClick:()=>m("moves"),className:"sortable-header",title:"Click to sort by Moves",children:["Moves ",l==="moves"&&(i==="desc"?"▼":"▲")]}),s.jsxs("th",{onClick:()=>m("totalGames"),className:"sortable-header",title:"Click to sort by Total Games",children:["Total Games ",l==="totalGames"&&(i==="desc"?"▼":"▲")]}),s.jsx("th",{children:"Stats (Lichess)"})]})}),s.jsx("tbody",{children:y.map((e,t)=>{var c;const a=M(e),n=((c=e.stats)==null?void 0:c.total)||0;return s.jsxs("tr",{children:[s.jsx("td",{children:e.opening}),s.jsx("td",{children:e.chapter}),s.jsx("td",{children:e.study}),s.jsx("td",{children:e.variation}),s.jsx("td",{className:"moves-cell",children:e.moves.join(" ")}),s.jsx("td",{className:"total-games-cell",children:n>0?n.toLocaleString():"-"}),s.jsxs("td",{className:"stats-cell",children:[s.jsx("div",{children:a.text}),a.percentages&&s.jsxs("div",{className:"stats-bar",children:[s.jsx("div",{className:"stats-bar-white",style:{width:`${a.percentages.white}%`},title:`White: ${a.percentages.white.toFixed(1)}%`}),s.jsx("div",{className:"stats-bar-draw",style:{width:`${a.percentages.draws}%`},title:`Draws: ${a.percentages.draws.toFixed(1)}%`}),s.jsx("div",{className:"stats-bar-black",style:{width:`${a.percentages.black}%`},title:`Black: ${a.percentages.black.toFixed(1)}%`})]})]})]},t)})})]})})]})}I.createRoot(document.getElementById("root")).render(s.jsx(U.StrictMode,{children:s.jsx(P,{})}));
