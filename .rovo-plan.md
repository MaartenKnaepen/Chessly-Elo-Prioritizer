# Implementation Plan: Fix Stale DOM & Expand Filters

## 1. Context & Goal
The extraction process is flaky because the Content Script loses reference to the active DOM element after clicking (React re-render). We will fix this by re-querying the element by ID.
We will also fix the "Unknown Study" issue by using wildcard CSS selectors to ignore hash suffixes, and ensure the Dashboard has the complete list of Lichess filters.

## 2. Memory Update
Refactoring `src/content/index.ts` to handle React DOM updates by re-fetching elements by ID. Relaxing CSS selectors to be resilient to CSS Module hashes. Updating Dashboard configuration.

## 3. Step-by-Step Instructions

### Step 1: Fix Stale DOM in Content Script
**Action:** Modify `src/content/index.ts`
**Description:**
- **In `processChapter`:**
    - Capture the `id` of the `chapterDiv` (e.g., `chapter-123...`).
    - Pass this `chapterId` to `expandChapter` instead of the element.
- **In `expandChapter`:**
    - `document.getElementById(chapterId)` to get the fresh element.
    - Click header.
    - Pass `chapterId` to `waitForChapterContent`.
- **In `waitForChapterContent`:**
    - Inside the loop, `const freshDiv = document.getElementById(chapterId)`.
    - Check `freshDiv.querySelectorAll(...)`.
- **In `extractStudiesFromChapter`:**
    - Accept `chapterId` and fetch the fresh element before querying studies.

### Step 2: Fix Study Name Selector (Wildcards)
**Action:** Modify `src/content/index.ts`
**Description:**
- **In `extractStudiesFromChapter`:**
    - Update the container selector to be hash-agnostic.
    - Change: `link.closest('div[class*="ChapterStudy_chapterStudyContainer"]')` (Wildcard match).
    - Update Title selector: `container.querySelector('[class*="bold13"], [class*="studyTitle"]')`.
    - Ensure we strictly avoid the "Learn" button text.

### Step 3: Verify Dashboard Filters
**Action:** Modify `src/dashboard/App.tsx`
**Description:**
- Check `ALL_SPEEDS`. Ensure it includes: `['ultraBullet', 'bullet', 'blitz', 'rapid', 'classical', 'correspondence']`.
- Check `ALL_RATINGS`. Ensure it includes: `[400, 1000, 1200, 1400, 1600, 1800, 2000, 2200, 2500]`.
- Add a helper function `formatSpeed(speed)` to capitalize "Ultra Bullet" correctly in the UI.

## 4. Verification
1.  Run `npm run build`.
2.  Reload Extension.
3.  **Test Ex
