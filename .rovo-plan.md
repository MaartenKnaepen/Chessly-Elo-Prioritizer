# Implementation Plan: Fix Content Script Selectors & Logic

## 1. Context & Goal
The Content Script (`src/content/index.ts`) failed to detect that chapters were collapsed because the class selectors did not match the site's React-generated class names (e.g., `Chapter_chapterHeader__...`).
We need to update the selectors to target these specific patterns and refine the link extraction to only target the "Learn" link (excluding Video/Quiz/Drill links).

## 2. Memory Update
Refining `src/content/index.ts` to correctly detect collapsed chapters using `Chapter_open` class check and targeting specific header elements for expansion. Adding filtering to `extractStudiesFromChapter` to ignore non-study URLs.

## 3. Step-by-Step Instructions

### Step 1: Update Content Script Logic
**Action:** Modify `src/content/index.ts`
**Description:**
- **Refactor `isChapterCollapsed`:**
    - Check if `chapterDiv.className` includes `"Chapter_open"` or `"open"`.
    - Logic: If it *does* include "open", return `false` (it is expanded). If not, return `true` (needs expansion).
- **Refactor `expandChapter`:**
    - Update the click selector to target `div[class*="Chapter_chapterHeader"]`.
    - Keep the fallback selectors but prioritize the specific one.
- **Refactor `extractStudiesFromChapter`:**
    - Update the filtering logic.
    - Iterate through `a[href*="/studies/"]`.
    - **Filter:** Exclude links ending in `/video`, `/quizzes`, or `/drill-shuffle`.
    - Only return the clean "Learn" links.

## 4. Verification
1.  Run `npm run build`.
2.  Reload the extension in Chrome.
3.  Refresh the Chessly page.
4.  Run "Start Extraction".
5.  **Observe:**
    - The script should explicitly log `ðŸ”“ Expanding chapter...`.
    - It should wait.
    - It should log `âœ… Found X studies` (where X > 0).
    - The Popup should populate with a progress count matching the real number of studies.
